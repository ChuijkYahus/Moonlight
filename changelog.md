improved some hacky capability code